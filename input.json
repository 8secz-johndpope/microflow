{
  "id": "main",
  "states": {
    "done": { "type": "final" },
    "failed": { "type": "final" },
    "testing": { "on": { "test_complete": { "target": "ready_for_dev" } } },
    "waiting": { "on": { "upload_file": { "target": "uploading" } } },
    "uploading": {
      "invoke": {
        "src": { "type": "fake" },
        "onDone": { "target": "ready_to_test" },
        "onError": { "target": "failed" }
      }
    },
    "deploy_to_acc": {
      "invoke": {
        "src": { "type": "fake" },
        "onDone": { "target": "ready_for_prod" },
        "onError": { "target": "failed" }
      }
    },
    "deploy_to_dev": {
      "invoke": {
        "src": { "type": "fake" },
        "onDone": { "target": "ready_for_test" },
        "onError": { "target": "failed" }
      }
    },
    "ready_for_acc": { "on": { "approve_acc": { "target": "deploy_to_acc" } } },
    "ready_for_dev": {
      "on": {
        "approve_dev": { "target": "deploy_to_dev" },
        "upload_file": { "target": "uploading" }
      }
    },
    "ready_to_test": {
      "on": {
        "test": { "target": "start_test_dag" },
        "upload_file": { "target": "uploading" }
      }
    },
    "deploy_to_prod": {
      "invoke": {
        "src": { "type": "fake" },
        "onDone": { "target": "start_confluence_dag" },
        "onError": { "target": "failed" }
      }
    },
    "deploy_to_test": {
      "invoke": {
        "src": { "type": "fake" },
        "onDone": { "target": "ready_for_acc" },
        "onError": { "target": "failed" }
      }
    },
    "ready_for_prod": {
      "on": { "approve_prod": { "target": "deploy_to_prod" } }
    },
    "ready_for_test": {
      "on": { "approve_test": { "target": "deploy_to_test" } }
    },
    "start_test_dag": {
      "invoke": {
        "src": {
          "type": "http",
          "inputPath": {},
          "parameters": {
            "dagId": "dag1",
            "data": "$.data"
          },
          "resultSelector": {},
          "resultPath": {},
          "taskId": "airflow"
        },
        "onDone": { "target": "testing" },
        "onError": { "target": "failed" }
      }
    },
    "updating_confluence": {
      "on": { "confluence_complete": { "target": "done" } }
    },
    "start_confluence_dag": {
      "invoke": {
        "src": {
          "type": "http",
          "inputPath": {},
          "parameters": {
            "dagId": "dag2",
            "data": "$.data"
          },
          "resultSelector": {},
          "resultPath": {},
          "taskId": "airflow"
        },
        "onDone": { "target": "updating_confluence" },
        "onError": { "target": "failed" }
      }
    }
  },
  "context": {},
  "initial": "waiting"
}
